version: '3'

tasks:
  default:
    desc: Show available tasks
    cmds:
      - task -l
    silent: true

  init:
    desc: Initialize project dependencies
    cmds:
      - |
        if [ -f package.json ]; then
          npm install
        elif [ -f go.mod ]; then
          go mod tidy
        elif [ -f requirements.txt ]; then
          python3 -m venv .venv && . .venv/bin/activate && pip install -r requirements.txt
        else
          echo "No known dependency file found (package.json, go.mod, requirements.txt)."
        fi

  build:
    desc: Build the project (auto-detect)
    cmds:
      - |
        if [ -f package.json ]; then
          npm run build
        elif [ -f go.mod ]; then
          go build ./...
        else
          echo "Nothing to build."
        fi

  test:
    desc: Run tests (auto-detect)
    cmds:
      - |
        if [ -f package.json ]; then
          npm test || npm run test
        elif [ -f go.mod ]; then
          go test ./...
        elif [ -d tests ]; then
          pytest -q || echo "pytest not found"
        else
          echo "No tests detected."
        fi

  clean:
    desc: Clean build artifacts
    cmds:
      - rm -rf dist build .pytest_cache coverage .venv node_modules 2>/dev/null || true
      - |
        [ -d bin ] && rm -rf bin || true
        [ -d out ] && rm -rf out || true